<!-- üìÅ src/views/secretary/Document/RequestDocument.vue -->
<template>
  <SecreLayout>
    <div class="page-content">
      <!-- ‚úÖ ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏ä‡πâ gradient ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á-‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô -->
      <h1 class="text-4xl font-bold mb-6 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
        Request Document
      </h1>

      <!-- ‚úÖ ‡∏õ‡πä‡∏≠‡∏ö‡∏≠‡∏±‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• -->
      <div v-if="showRejectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>

          <div class="space-y-3 mb-6">
            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
              <input type="radio" v-model="selectedReason" value="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ú‡∏¥‡∏î" class="mr-3">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ú‡∏¥‡∏î
            </label>
            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
              <input type="radio" v-model="selectedReason" value="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô" class="mr-3">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
            </label>
          </div>

          <div class="flex gap-3">
            <button @click="confirmReject" class="flex-1 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:shadow-lg transition-all transform hover:-translate-y-0.5 mr-2">
              ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            </button>
            <button @click="cancelReject" class="flex-1 px-4 py-2 bg-rose-500 border border-gray-300 text-white rounded-lg hover:shadow-lg transition-all transform hover:-translate-y-0.5 mr-2">
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </div>
        </div>
      </div>

      <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠ -->
      <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
        <!-- ‚úÖ Header ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á gradient ‡∏≠‡πà‡∏≠‡∏ô -->
        <table class="w-full">
          <thead class="bg-gradient-to-r from-indigo-50 to-violet-50">
            <tr>
              <th class="px-6 py-4 text-left text-sm font-bold text-indigo-800">No</th>
              <th class="px-6 py-4 text-left text-sm font-bold text-indigo-800">ID</th>
              <th class="px-6 py-4 text-left text-sm font-bold text-indigo-800">Date</th>
              <th class="px-6 py-4 text-left text-sm font-bold text-indigo-800">Topic</th>
              <th class="px-6 py-4 text-right text-sm font-bold text-indigo-800">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr v-for="item in requests" :key="item.no" class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ item.no }}</td>
              <td class="px-6 py-4 text-sm text-gray-700">{{ item.studentId }}</td>
              <td class="px-6 py-4 text-sm text-gray-700">{{ item.date }}</td>
              <td class="px-6 py-4 text-sm text-gray-700">{{ item.topic }}</td>
              <td class="px-6 py-4 text-right">
                <!-- ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á Pending -->
                <template v-if="item.status === 'Pending'">
                  <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Approve ‚Üí ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (emerald) + ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô ‚úÖ -->
                  <button
                    @click="approve(item)"
                    class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-xl bg-emerald-500 text-white hover:bg-emerald-600 shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 mr-2"
                  >
                    <span>‚úÖ</span>
                    <span class="ml-1.5">Approve</span>
                  </button>
                  <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Reject ‚Üí ‡∏™‡∏µ‡πÅ‡∏î‡∏á (rose) + ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô ‚ùå -->
                  <button
                    @click="reject(item)"
                    class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-xl bg-rose-500 text-white hover:bg-rose-600 shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5"
                  >
                    <span>‚ùå</span>
                    <span class="ml-1.5">Reject</span>
                  </button>
                </template>

                <!-- ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Approved ‚Üí badge + ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô -->
                <span
                  v-else-if="item.status === 'Approved'"
                  class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-xl bg-emerald-100 text-emerald-800"
                >
                  <span>‚úÖ</span>
                  <span class="ml-1.5">Approved</span>
                </span>

                <!-- ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Rejected ‚Üí badge + ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô -->
                <span
                  v-else
                  class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-xl bg-rose-100 text-rose-800"
                >
                  <span>‚ùå</span>
                  <span class="ml-1.5">Rejected</span>
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </SecreLayout>
</template>

<script setup>
import { ref } from 'vue'
import SecreLayout from '@/layouts/secretary/SecreLayout.vue'

const requests = ref([
  { no: 'A001', studentId: '65xxxxxxxx', date: '21 Apr 2025', topic: 'Course registration', status: 'Pending' },
  { no: 'A002', studentId: '65xxxxxxxx', date: '21 Apr 2025', topic: 'Course registration', status: 'Pending' },
  { no: 'A003', studentId: '65xxxxxxxx', date: '21 Apr 2025', topic: 'Course registration', status: 'Pending' }
])

// ‚úÖ 1. state ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pop-up
const showRejectModal = ref(false)
const selectedReason = ref('')
const currentRejectItem = ref(null) // ‡πÄ‡∏Å‡πá‡∏ö item ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞ reject

// ‚úÖ ‡πÉ‡∏ä‡πâ splice ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Vue ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
const approve = (item) => {
  const index = requests.value.findIndex(r => r.no === item.no)
  if (index !== -1) {
    requests.value.splice(index, 1, { ...item, status: 'Approved' })
  }
}

// ‚úÖ 2. ‡πÅ‡∏Å‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô reject ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î Pop-up
const reject = (item) => {
  currentRejectItem.value = item
  showRejectModal.value = true
}

// ‚úÖ 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£ Reject
const confirmReject = async () => {
  if (!selectedReason.value) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•')

  const index = requests.value.findIndex(r => r.no === currentRejectItem.value.no)
  if (index !== -1) {
    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï status ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° field rejectionReason
    requests.value.splice(index, 1, { 
      ...currentRejectItem.value, 
      status: 'Rejected',
      rejectionReason: selectedReason.value // ‚≠êÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
    })
  }

  // ‚úÖ ‡∏õ‡∏¥‡∏î Pop-up
  showRejectModal.value = false
  selectedReason.value = ''
}

// ‚úÖ 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
const cancelReject = () => {
  showRejectModal.value = false
  selectedReason.value = ''
}

</script>

<style scoped>
.page-content {
  padding: 2rem;
  min-height: 100vh;
  box-sizing: border-box;
}
</style>